---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code.

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*.

```{r}
plot(cars)
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

```{r}
install.packages('lubridate')
install.packages('tidyverse')

```

```{r}
library(lubridate)
library(tidyverse)

```

Import required library

```{r}
library(ggplot2)
```

```{r}
# Import dataset
cases_malaysia <- read.csv("E:/UTeM/Sem 3/Statistics and Probability/A/A2/code/data/cases_malaysia.csv")
population <- read.csv("E:/UTeM/Sem 3/Statistics and Probability/A/A2/code/data/population.csv")
```

Retrieve data based on desired range which is 01-02-2020 to 30-11-2021 only.

```{r}
cases_MY <- cases_malaysia[cases_malaysia$date >= "2020-02-01" & cases_malaysia$date <= "2021-11-30",]
```

```{r}
View(cases_MY)
```

```{r}
t.test(cases_MY$cases_new, y = NULL, alternative = c("two.sided"), mu = 0, paired = FALSE, var.equal = FALSE, conf.level = 0.95)

t.test(cases_MY$cases_new, y = NULL, alternative = c("two.sided"), mu = 0, paired = FALSE, var.equal = FALSE, conf.level = 0.99)
```

```{r}
# ggplot(cases_MY$cases_unvax, date =  )
ggplot(cases_MY, aes(x = as.Date(date), y = cases_unvax, group = 1)) + geom_line()
```

```{r}
population_MY <- population[population$state == "Malaysia",]

pop_MY <- population_MY$pop
pop12_MY <- population_MY$pop_12
pop18_MY <- population_MY$pop_18
pop60_MY <- population_MY$pop_60
```

```{r}
total_cases <- sum(cases_MY$cases_new)
total_infected_percentage <- total_cases / pop_MY * 100
print(total_cases)
print(total_infected_percentage)
#print(infected_percentage * pop_MY)

print("Child")
print(sum(cases_MY$cases_child + cases_MY$cases_adolescent) / pop12_MY * 100)
```

```{r}
mean(cases_MY$cases_new)
mean(cases_MY$cases_new, na.rm = TRUE)
```

```{r}
firstTwo <- cases_MY[cases_MY$date >= "2020-02-01" & cases_MY$date <= "2020-03-31", ]
#View(firstTwo)
t.test(firstTwo$cases_new, y = NULL, alternative = c("two.sided"), mu = 0, paired = FALSE, var.equal = FALSE, conf.level = 0.95)
```

```{r}
firstFour <- cases_MY[cases_MY$date >= "2020-02-01" & cases_MY$date <= "2020-05-31", ]
t.test(firstFour$cases_new, y = NULL, alternative = c("two.sided"), mu = 0, paired = FALSE, var.equal = FALSE, conf.level = 0.95)
```

```{r}
#seq(as.Date(cut(as.Date("2020-03-31"), "month")), length=2, by="+2 month")[2]-1
## "2012-06-30"
#lubricate
#base_date <- "2020-03-31"
base_date <- "2020-03-31"

firstFour <- cases_MY[cases_MY$date >= "2020-02-01" & cases_MY$date <= base_date, ]
t.test(firstFour$cases_new, y = NULL, alternative = c("two.sided"), mu = 0, paired = FALSE, var.equal = FALSE, conf.level = 0.95)

for (x in 1:10) {
  #print(as.Date("2020-03-31") %m+% months(2))
  update <- as.Date(base_date) %m+% months(2)
  base_date <- update
  filtered <- cases_MY[cases_MY$date >= "2020-02-01" & cases_MY$date <= base_date, ]
dt <- t.test(filtered$cases_new, y = NULL, alternative = c("two.sided"), mu = 0, paired = FALSE, var.equal = FALSE, conf.level = 0.95)
  #print(base_date)
print(dt)
print(mean(filtered$cases_new))
}

```

```{r}
# retrieve cases for under 18 child

base_date <- "2020-03-31"

firstFour <- cases_MY[cases_MY$date >= "2020-02-01" & cases_MY$date <= base_date, ]
t.test(firstFour$cases_new, y = NULL, alternative = c("two.sided"), mu = 0, paired = FALSE, var.equal = FALSE, conf.level = 0.95)

for (x in 1:10) {
  base_date <- as.Date(base_date) %m+% months(2)
  filtered <- cases_MY[cases_MY$date >= "2020-02-01" & cases_MY$date <= base_date,]
  #cases12 <- filtered[filtered$]
  cases_12 <- filtered$cases_0_4 + filtered$cases_5_11 + filtered$cases_12_17
  total_12 <- data.frame(date = filtered$date, cases = cases_12)
 # View(cases_12)
  #View(total_12)
  cases12 <- t.test(total_12$cases, y = NULL, alternative = "two.sided", mu = 0, paired = FALSE, var.equal = FALSE, conf.level = 0.95)
  print(cases12)
  print(mean(filtered$cases_new))
}
  print(sum(total_12$cases))

```

```{r}
# retrieve cases for child alternative

base_date <- "2020-03-31"

firstFour <- cases_MY[cases_MY$date >= "2020-02-01" & cases_MY$date <= base_date, ]
t.test(firstFour$cases_child + firstFour$cases_adolescent, y = NULL, alternative = c("two.sided"), mu = 0, paired = FALSE, var.equal = FALSE, conf.level = 0.95)

for (x in 1:10) {
  base_date <- as.Date(base_date) %m+% months(2)
  filtered <- cases_MY[cases_MY$date >= "2020-02-01" & cases_MY$date <= base_date,]
  cases12 <- t.test(filtered$cases_child + filtered$cases_adolescent, y = NULL, alternative = "two.sided", mu = 0, paired = FALSE, var.equal = FALSE, conf.level = 0.95)
  print(cases12)
  #print(mean(filtered$cases_child + filtered$cases_adolescent))
}
print(sum(filtered$cases_child + filtered$cases_adolescent))

```

```{r}
# retrieve cases for adult

base_date <- "2020-03-31"

firstFour <- cases_MY[cases_MY$date >= "2020-02-01" & cases_MY$date <= base_date, ]
t.test(firstFour$cases_adult, y = NULL, alternative = c("two.sided"), mu = 0, paired = FALSE, var.equal = FALSE, conf.level = 0.95)

for (x in 1:10) {
  base_date <- as.Date(base_date) %m+% months(2)
  filtered <- cases_MY[cases_MY$date >= "2020-02-01" & cases_MY$date <= base_date,]
  cases18 <- t.test(filtered$cases_adult, y = NULL, alternative = "two.sided", mu = 0, paired = FALSE, var.equal = FALSE, conf.level = 0.95)
  print(cases18)
 # print(mean(filtered$cases_new))
}
print(sum(filtered$cases_adult))

```

```{r}
# retrieve cases for elderly

base_date <- "2020-03-31"

firstFour <- cases_MY[cases_MY$date >= "2020-02-01" & cases_MY$date <= base_date, ]
t.test(firstFour$cases_elderly, y = NULL, alternative = c("two.sided"), mu = 0, paired = FALSE, var.equal = FALSE, conf.level = 0.95)

for (x in 1:10) {
  base_date <- as.Date(base_date) %m+% months(2)
  filtered <- cases_MY[cases_MY$date >= "2020-02-01" & cases_MY$date <= base_date,]
  cases60 <- t.test(filtered$cases_elderly, y = NULL, alternative = "two.sided", mu = 0, paired = FALSE, var.equal = FALSE, conf.level = 0.95)
  print(cases60)
 # print(mean(filtered$cases_new))
}
print(sum(filtered$cases_elderly))
```

```{r}
base_date <- "2020-03-31"

firstFour <- cases_MY[cases_MY$date >= "2020-02-01" & cases_MY$date <= base_date, ]
t.test(firstFour$cases_elderly, y = NULL, alternative = c("two.sided"), mu = 0, paired = FALSE, var.equal = FALSE, conf.level = 0.95)

for (x in 1:10) {
  base_date <- as.Date(base_date) %m+% months(2)
  filtered <- cases_MY[cases_MY$date >= "2020-02-01" & cases_MY$date <= base_date,]
  cases60 <- t.test(filtered$cases_elderly, y = NULL, alternative = "two.sided", mu = 0, paired = FALSE, var.equal = FALSE, conf.level = 0.95)
 # print(cases60$estimate)
  #print(cases60$conf.int)
  print(toString(round(cases60$estimate, digits = 4)))
  print(toString(round(cases60$conf.int, digits = 4)))
 # print(mean(filtered$cases_new))
}
print(sum(filtered$cases_elderly))
```

```{r}
base_date <- "2020-03-31"

firstFour <- cases_MY[cases_MY$date >= "2020-02-01" & cases_MY$date <= base_date, ]
cases60 <- t.test(firstFour$cases_elderly, y = NULL, alternative = c("two.sided"), mu = 0, paired = FALSE, var.equal = FALSE, conf.level = 0.95)

#df = data.frame(date = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10 , 11))

df = data.frame()

first <- data.frame(date = toString(paste("2020-02-01 - ", base_date)), mean = toString(round(cases60$estimate, digits = 4)), confidence_interval = toString(round(cases60$conf.int, digits = 4)))

#first <- head(first, n = 1)
first <- tail(first, n = 1)

df = rbind(df, first)

for (x in 1:10) {
  base_date <- as.Date(base_date) %m+% months(2)
  filtered <- cases_MY[cases_MY$date >= "2020-02-01" & cases_MY$date <= base_date,]
  cases60 <- t.test(filtered$cases_elderly, y = NULL, alternative = "two.sided", mu = 0, paired = FALSE, var.equal = FALSE, conf.level = 0.95)
 # print(cases60$estimate)
  #print(cases60$conf.int)
 # print(toString(round(cases60$estimate, digits = 4)))
  #print(toString(round(cases60$conf.int, digits = 4)))
 # print(mean(filtered$cases_new))
second <- data.frame(date = toString(paste("2020-02-01 - ", base_date)), mean = toString(round(cases60$estimate, digits = 4)), confidence_interval = toString(round(cases60$conf.int, digits = 4)))
  
  #second <- head(second, n = 1)
  second <- tail(second, n = 1)
  
  df = rbind(df, second)
  
  #third <- rbind(first, second)
}
#View(third)
#df
rownames(df) <- 1:nrow(df)    # Assign sequence to row names
View(df)
# print(sum(filtered$cases_elderly))
```
